# 211109_TIL

## ì˜¤ëŠ˜ í•œ ì¼

- ë¡œê·¸ì¸ 
  - JWT Token LocalStorageì— ì €ì¥
  - JWT Token ê³µìœ 



### JWT Token LocalStorageì— ì €ì¥

#### useLocalStorage

> Sync state to local storage so tha it persists through a page refresh. Usage is similar to useState except we pass in a local storage key so that we can default to that value on page load instead of the specified initial value.
>https://usehooks.com/useLocalStorage/

useHooks ì›¹ì‚¬ì´íŠ¸ì˜ useLocalStorageë¥¼ ì‚¬ìš©í•´ JWT Tokenì„ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•©ë‹ˆë‹¤.  ìµœìƒìœ„ì—ì„œë§Œ Hookì„ í˜¸ì¶œí•´ì•¼ í•˜ëŠ” ë¦¬ì•¡íŠ¸ì˜ ê·œì¹™ì— ë”°ë¼ Hookìœ¼ë¡œ ì‘ì„±ëœ seLocalStorageë¥¼ í•¨ìˆ˜ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

```jsx
import { useState } from 'react';

export function getStorageItem(key, initialValue) {
  try {
    const item = window.localStorage.getItem(key);
    return item ? JSON.parse(item) : initialValue;
  } catch (error) {
    console.log(error);
    return initialValue;
  }
}

export function setStorageItem(key, value) {
  try {
    window.localStorage.setItem(key, JSON.stringify(value));
  } catch (error) {
    console.log(error);
  }
}

export default function useLocalStorage(key, initialValue) {
  const [storedValue, setStoredValue] = useState(() => {
    return getStorageItem(key, initialValue);
  });

  const setValue = (value) => {
    const valueToStore = value instanceof Function ? value(storedValue) : value;
    setStoredValue(valueToStore);
    setStorageItem(key, valueToStore);
  };
  return [storedValue, setValue];
}
```



### JWT Token ê³µìœ í•˜ê¸°

#### Context APIì™€ Reducer í™œìš©

ë¡œê·¸ì¸í•´ì„œ ì„œë²„ë¡œë¶€í„° JWT í† í°ì„ ë°œê¸‰ë°›ì•„ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•˜ê³  ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ Context APIì™€ Reducerë¥¼ ì´ìš©í•´ ì „ë‹¬í•˜ë ¤ê³  í•©ë‹ˆë‹¤. jwt tokenì„ ì €ì¥í•˜ê¸° ìœ„í•œ actionì´ ë°œìƒë˜ì–´ reducer ë‚´ì—ì„œ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•˜ê³ ì êµ¬í˜„í•  ë•Œ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

> **ğŸš¨ React Hooks must be called in a React function component or a custom React Hook function.**

reducerëŠ” ìˆœìˆ˜í•¨ìˆ˜ë¡œì„œ side effectsë¥¼ ë°œìƒì‹œí‚¤ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤. **side effects**ëŠ” API ìš”ì²­ì´ë‚˜ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì ‘ê·¼í•˜ëŠ” ë“± í•¨ìˆ˜ ì™¸ë¶€ì— ì¡´ì¬í•˜ëŠ” ê°’ì´ë‚˜ ìƒíƒœë¥¼ ë³€ê²½ì‹œí‚¤ëŠ” ë™ì‘ì„ ëœ»í•©ë‹ˆë‹¤. reducer ë‚´ì—ì„œ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì ‘ê·¼í•´ jwt í† í°ì„ ì €ì¥í•´ì•¼ í–ˆê¸°ì— `use-reducer-with-side-effects`ë¥¼ í™œìš©í•©ë‹ˆë‹¤.

https://github.com/conorhastings/use-reducer-with-side-effects

```jsx
import React, { createContext, useContext } from 'react';
import { getStorageItem, setStorageItem } from 'utils/useLocalStorage';
import useReducerWithSideEffects, {
  UpdateWithSideEffect,
} from 'use-reducer-with-side-effects';

const AppContext = createContext();

const reducer = (prevState, action) => {
  const { type } = action;
  switch (type) {
    case SET_TOKEN: {
      const { payload: jwtToken } = action;
      const newState = {
        ...prevState,
        jwtToken,
      };
      return UpdateWithSideEffect(newState, (state, dispatch) => {
        setStorageItem('jwtToken', jwtToken);
      });
    }
    case DELETE_TOKEN: {
      const newState = {
        ...prevState,
        jwtToken: '',
      };
      return UpdateWithSideEffect(newState, (state, dispatch) => {
        setStorageItem('jwtToken', '');
      });
    }
    default:
      return;
  }
};

export const AppProvider = ({ children }) => {
  const [store, dispatch] = useReducerWithSideEffects(reducer, {
    jwtToken: getStorageItem('jwtToken', ''),
  });
  return (
    <AppContext.Provider value={{ store, dispatch }}>
      {children}
    </AppContext.Provider>
  );
};

export const useAppContext = () => useContext(AppContext);

// Actions
const SET_TOKEN = 'APP/SET_TOKEN';
const DELETE_TOKEN = 'APP/DELETE_TOKEN';

// Action Creatores
export const setToken = (token) => ({ type: SET_TOKEN, payload: token });
export const deleteToken = (token) => ({ type: DELETE_TOKEN });
```



#### Usage

```jsx
ğŸ“„ index.js // ìµœìƒìœ„ ì»´í¬ë„ŒíŠ¸ë¥¼ Providerë¡œ ê°ì‹¸ì¤˜ì•¼í•©ë‹ˆë‹¤.
ReactDOM.render(
  <BrowserRouter>
    <AppProvider>
      <Root />
    </AppProvider>
  </BrowserRouter>,
  document.getElementById('root')


ğŸ“„ Login.jsx
import { useAppContext, setToken } from 'store';
			// ìƒëµ
	const { dispatch } = useAppContext()
	const onFinish = () => {
        // post api request
        dispatch(setToken(jwtToken));
    }
```



## ì°¸ê³ ìë£Œ

[[React\] useEffect()ì™€ Side-Effect](https://points.tistory.com/86)

[useHooks](https://usehooks.com/)

[Hookì˜ ê·œì¹™](https://ko.reactjs.org/docs/hooks-rules.html)

